# 关键点可视化指南

## 概述

本指南介绍如何将关键点数据可视化，绘制到画布上并保存为图像文件。

## 快速开始

### 基本使用

```bash
python visualize_phoenix_keypoints.py phoenix_keypoints_test.pkl
```

这会：
- 处理所有划分（train, dev, test）
- 每个划分可视化 5 个样本
- 生成完整骨架、组件和组合图像
- 生成网格图像

### 只可视化训练集

```bash
python visualize_phoenix_keypoints.py phoenix_keypoints_test.pkl --splits train
```

### 可视化更多样本

```bash
python visualize_phoenix_keypoints.py phoenix_keypoints_test.pkl --num_samples 10
```

## 详细参数说明

### 必需参数

- `pkl_path`: PHOENIX 关键点 pickle 文件路径

### 可选参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `--output_dir` | 输出目录 | `phoenix_keypoints_visualization` |
| `--splits` | 要可视化的划分 | `None` (所有划分) |
| `--num_samples` | 每个划分的样本数 | `5` |
| `--image_size` | 图像大小（像素） | `512` |
| `--no-individual` | 不生成单独的组件图像 | `False` |
| `--no-combined` | 不生成组合图像 | `False` |
| `--no-grid` | 不生成网格图像 | `False` |

## 输出文件说明

### 目录结构

```
phoenix_keypoints_visualization/
├── train/
│   ├── sample_000_full_skeleton.png    # 完整骨架
│   ├── sample_000_face.png              # 面部关键点
│   ├── sample_000_hands.png             # 手部关键点
│   ├── sample_000_pose.png              # 姿态关键点
│   ├── sample_000_combined.png          # 组合图像
│   ├── sample_001_full_skeleton.png
│   └── ...
├── dev/
│   └── ...
├── test/
│   └── ...
├── grid_train_all_samples.png           # 训练集网格
├── grid_dev_all_samples.png             # 验证集网格
├── grid_test_all_samples.png             # 测试集网格
└── grid_all_splits.png                  # 所有划分汇总网格
```

### 图像类型

1. **完整骨架图像** (`*_full_skeleton.png`)
   - 包含所有关键点（面部、双手、姿态）
   - 显示完整的身体骨架结构

2. **组件图像** (`*_face.png`, `*_hands.png`, `*_pose.png`)
   - 分别显示面部、手部、姿态关键点
   - 用于详细分析各个部分

3. **组合图像** (`*_combined.png`)
   - 顶部：完整骨架
   - 底部：各个组件（面部、手部、姿态）
   - 方便对比查看

4. **网格图像** (`grid_*.png`)
   - 将多个样本排列成网格
   - 方便批量查看和对比

## 使用示例

### 示例 1: 快速查看

```bash
# 可视化所有划分，每个划分 3 个样本
python visualize_phoenix_keypoints.py phoenix_keypoints_test.pkl --num_samples 3
```

### 示例 2: 只生成完整骨架

```bash
# 不生成组件和组合图像，只生成完整骨架
python visualize_phoenix_keypoints.py phoenix_keypoints_test.pkl \
    --no-individual \
    --no-combined
```

### 示例 3: 自定义输出

```bash
# 自定义输出目录和图像大小
python visualize_phoenix_keypoints.py phoenix_keypoints_test.pkl \
    --output_dir my_visualization \
    --image_size 256 \
    --num_samples 10
```

### 示例 4: 只处理特定划分

```bash
# 只可视化训练集和验证集
python visualize_phoenix_keypoints.py phoenix_keypoints_test.pkl \
    --splits train dev \
    --num_samples 5
```

## 可视化内容说明

### 关键点类型

1. **面部关键点** (68个点)
   - 面部轮廓
   - 眉毛
   - 眼睛
   - 鼻子
   - 嘴巴

2. **手部关键点** (每只手21个点)
   - 手腕
   - 手指关节
   - 指尖

3. **姿态关键点** (33个点)
   - 身体主要关节
   - 肩膀、肘部、手腕
   - 臀部、膝盖、脚踝

### 绘制方式

- **关键点**: 用圆圈表示
- **连接线**: 连接相关的关键点，形成骨架结构
- **画布**: 白色背景，黑色关键点和线条

## Python 代码示例

### 在代码中使用

```python
import pickle
from visualize_phoenix_keypoints import visualize_phoenix_keypoints

# 加载数据
with open('phoenix_keypoints_test.pkl', 'rb') as f:
    data = pickle.load(f)

# 可视化
visualize_phoenix_keypoints(
    pkl_path='phoenix_keypoints_test.pkl',
    output_dir='my_output',
    splits=['train'],
    num_samples=5,
    image_size=512
)
```

### 单独绘制一个样本

```python
import pickle
import cv2
from utils.utils_skeleton import draw_full_skeleton

# 加载数据
with open('phoenix_keypoints_test.pkl', 'rb') as f:
    data = pickle.load(f)

# 获取第一个训练样本
sample = data['train']['keypoints'][0]

# 绘制完整骨架
skeleton_img = draw_full_skeleton(sample, image_size=512, point_radius=3, line_thickness=2)

# 保存
cv2.imwrite('my_skeleton.png', skeleton_img)

# 或者显示（如果在支持 GUI 的环境中）
# cv2.imshow('Skeleton', skeleton_img)
# cv2.waitKey(0)
# cv2.destroyAllWindows()
```

## 高级用法

### 批量生成所有样本

```bash
# 可视化所有样本（可能需要较长时间）
python visualize_phoenix_keypoints.py phoenix_keypoints_test.pkl \
    --num_samples 1000 \
    --no-individual \
    --no-combined
```

### 生成不同尺寸的图像

```bash
# 生成小尺寸图像（用于快速预览）
python visualize_phoenix_keypoints.py phoenix_keypoints_test.pkl \
    --image_size 256 \
    --num_samples 10

# 生成大尺寸图像（用于详细分析）
python visualize_phoenix_keypoints.py phoenix_keypoints_test.pkl \
    --image_size 1024 \
    --num_samples 5
```

## 常见问题

### 1. 某些关键点未检测到

如果某些关键点显示为 `None`，说明在原始图像中未检测到该部分。这是正常的，因为：
- 手可能被遮挡
- 人物可能不在画面中
- 检测置信度可能较低

### 2. 图像大小调整

如果关键点显示太小或太大，可以调整 `--image_size` 参数：
- 增大尺寸：`--image_size 1024`
- 减小尺寸：`--image_size 256`

### 3. 内存不足

如果处理大量样本时内存不足：
- 减少 `--num_samples`
- 减小 `--image_size`
- 使用 `--no-individual` 和 `--no-combined` 减少生成的文件

### 4. 查看生成的图像

```bash
# 查看输出目录
ls -lh phoenix_keypoints_visualization/train/

# 使用图像查看器打开
# Linux: eog phoenix_keypoints_visualization/train/sample_000_full_skeleton.png
# Mac: open phoenix_keypoints_visualization/train/sample_000_full_skeleton.png
```

## 相关工具

- **`view_keypoints.py`**: 查看关键点文件信息
- **`test_keypoints.py`**: 测试和可视化标准格式的关键点
- **`utils/utils_skeleton.py`**: 骨架绘制工具函数

## 相关文档

- [如何查看关键点文件.md](./如何查看关键点文件.md)
- [PHOENIX数据集关键点提取指南.md](./PHOENIX数据集关键点提取指南.md)
- [项目 README.md](../README.md)

---

**文档创建时间**: 2024年
**适用文件**: phoenix_keypoints*.pkl


