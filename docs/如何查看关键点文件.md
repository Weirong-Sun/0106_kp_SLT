# 如何查看关键点文件

## 方法 1: 使用查看脚本（推荐）

项目提供了专门的查看脚本 `view_keypoints.py`：

### 基本查看

```bash
python view_keypoints.py phoenix_keypoints_test.pkl
```

**输出内容**：
- 文件基本信息（大小、类型）
- 数据集结构（train/dev/test 划分）
- 样本统计信息
- 关键点信息
- 提取统计

### 详细查看

```bash
python view_keypoints.py phoenix_keypoints_test.pkl --detailed
```

**额外显示**：
- 第一个样本的详细关键点数据
- 关键点的形状和数据类型
- 坐标范围

### 保存统计信息

```bash
python view_keypoints.py phoenix_keypoints_test.pkl --save_json stats.json
```

将统计信息保存为 JSON 格式，方便后续分析。

## 方法 2: 使用 Python 交互式查看

### 快速查看

```python
import pickle
import numpy as np

# 加载文件
with open('phoenix_keypoints_test.pkl', 'rb') as f:
    data = pickle.load(f)

# 查看数据结构
print("数据键:", list(data.keys()))

# 查看训练集
if 'train' in data:
    train_data = data['train']
    print(f"训练集样本数: {len(train_data['keypoints'])}")
    print(f"唯一视频数: {len(set(train_data['video_ids']))}")

    # 查看第一个样本
    if len(train_data['keypoints']) > 0:
        sample = train_data['keypoints'][0]
        print("\n第一个样本:")
        for kp_type in ['face', 'left_hand', 'right_hand', 'pose']:
            if kp_type in sample:
                kp = sample[kp_type]
                if kp is not None:
                    print(f"  {kp_type}: shape {kp.shape}")
                else:
                    print(f"  {kp_type}: None")
```

### 详细分析

```python
import pickle
import numpy as np

# 加载文件
with open('phoenix_keypoints_test.pkl', 'rb') as f:
    data = pickle.load(f)

# 分析每个划分
for split in ['train', 'dev', 'test']:
    if split in data:
        split_data = data[split]
        keypoints = split_data['keypoints']
        video_ids = split_data.get('video_ids', [])

        print(f"\n{split.upper()} 划分:")
        print(f"  样本数: {len(keypoints)}")
        print(f"  唯一视频数: {len(set(video_ids))}")

        # 统计关键点检测情况
        face_count = sum(1 for kp in keypoints if kp.get('face') is not None)
        left_hand_count = sum(1 for kp in keypoints if kp.get('left_hand') is not None)
        right_hand_count = sum(1 for kp in keypoints if kp.get('right_hand') is not None)
        pose_count = sum(1 for kp in keypoints if kp.get('pose') is not None)

        print(f"  面部检测: {face_count}/{len(keypoints)} ({face_count/len(keypoints)*100:.1f}%)")
        print(f"  左手检测: {left_hand_count}/{len(keypoints)} ({left_hand_count/len(keypoints)*100:.1f}%)")
        print(f"  右手检测: {right_hand_count}/{len(keypoints)} ({right_hand_count/len(keypoints)*100:.1f}%)")
        print(f"  姿态检测: {pose_count}/{len(keypoints)} ({pose_count/len(keypoints)*100:.1f}%)")
```

### 查看特定样本

```python
import pickle
import numpy as np

# 加载文件
with open('phoenix_keypoints_test.pkl', 'rb') as f:
    data = pickle.load(f)

# 查看训练集的第 10 个样本
split = 'train'
sample_idx = 10

if split in data and len(data[split]['keypoints']) > sample_idx:
    sample = data[split]['keypoints'][sample_idx]
    video_id = data[split]['video_ids'][sample_idx]
    image_path = data[split]['image_paths'][sample_idx]

    print(f"样本 {sample_idx}:")
    print(f"  视频ID: {video_id}")
    print(f"  图像路径: {image_path}")
    print(f"  关键点:")

    for kp_type in ['face', 'left_hand', 'right_hand', 'pose']:
        if kp_type in sample:
            kp = sample[kp_type]
            if kp is not None:
                print(f"    {kp_type}:")
                print(f"      形状: {kp.shape}")
                print(f"      数据类型: {kp.dtype}")
                print(f"      X 范围: [{kp[:, 0].min():.3f}, {kp[:, 0].max():.3f}]")
                print(f"      Y 范围: [{kp[:, 1].min():.3f}, {kp[:, 1].max():.3f}]")
                print(f"      Z 范围: [{kp[:, 2].min():.3f}, {kp[:, 2].max():.3f}]")
            else:
                print(f"    {kp_type}: None (未检测到)")
```

## 方法 3: 使用 Jupyter Notebook

创建一个 Jupyter Notebook 进行交互式分析：

```python
# 在 Jupyter Notebook 中
import pickle
import numpy as np
import matplotlib.pyplot as plt

# 加载数据
with open('phoenix_keypoints_test.pkl', 'rb') as f:
    data = pickle.load(f)

# 可视化统计信息
splits = ['train', 'dev', 'test']
sample_counts = [len(data[split]['keypoints']) for split in splits]

plt.bar(splits, sample_counts)
plt.title('各划分样本数')
plt.ylabel('样本数')
plt.show()
```

## 文件结构说明

PHOENIX 数据集关键点文件的结构：

```python
{
    'train': {
        'keypoints': [
            {
                'face': np.array([68, 3]) or None,      # 68个面部关键点
                'left_hand': np.array([21, 3]) or None, # 21个左手关键点
                'right_hand': np.array([21, 3]) or None,# 21个右手关键点
                'pose': np.array([33, 3]) or None,     # 33个姿态关键点
                'image_shape': (height, width)         # 图像尺寸
            },
            ...
        ],
        'image_paths': [str, ...],  # 对应的图像路径
        'video_ids': [str, ...]     # 对应的视频ID
    },
    'dev': {...},   # 验证集，格式同 train
    'test': {...},  # 测试集，格式同 train
    'stats': {
        'train': {'total': int, 'success': int, 'failed': int},
        'dev': {...},
        'test': {...}
    },
    'keypoint_info': {
        'face': {'num_points': 68, 'description': 'Facial landmarks'},
        'left_hand': {'num_points': 21, 'description': 'Left hand landmarks'},
        'right_hand': {'num_points': 21, 'description': 'Right hand landmarks'},
        'pose': {'num_points': 33, 'description': 'Body pose landmarks'},
        'total_points': 143
    },
    'dataset_info': {
        'name': 'PHOENIX-2014-T',
        'source_path': str,
        'splits': ['train', 'dev', 'test']
    }
}
```

## 常见操作

### 1. 检查文件是否存在

```bash
ls -lh phoenix_keypoints_test.pkl
```

### 2. 查看文件大小

```bash
du -h phoenix_keypoints_test.pkl
```

### 3. 验证文件完整性

```python
import pickle

try:
    with open('phoenix_keypoints_test.pkl', 'rb') as f:
        data = pickle.load(f)
    print("✓ 文件完整，可以正常加载")
except Exception as e:
    print(f"✗ 文件损坏: {e}")
```

### 4. 统计各划分的样本数

```python
import pickle

with open('phoenix_keypoints_test.pkl', 'rb') as f:
    data = pickle.load(f)

for split in ['train', 'dev', 'test']:
    if split in data:
        num_samples = len(data[split]['keypoints'])
        num_videos = len(set(data[split].get('video_ids', [])))
        print(f"{split}: {num_samples} 个样本, {num_videos} 个视频")
```

### 5. 查找特定视频的数据

```python
import pickle

with open('phoenix_keypoints_test.pkl', 'rb') as f:
    data = pickle.load(f)

# 查找特定视频
target_video_id = "03February_2010_Wednesday_tagesschau-2062"

for split in ['train', 'dev', 'test']:
    if split in data:
        video_ids = data[split]['video_ids']
        indices = [i for i, vid in enumerate(video_ids) if vid == target_video_id]
        if indices:
            print(f"{split} 划分中找到视频 {target_video_id}: {len(indices)} 个样本")
```

## 快速参考

```bash
# 基本查看
python view_keypoints.py phoenix_keypoints_test.pkl

# 详细查看
python view_keypoints.py phoenix_keypoints_test.pkl --detailed

# 保存统计
python view_keypoints.py phoenix_keypoints_test.pkl --save_json stats.json

# Python 快速查看
python -c "import pickle; d=pickle.load(open('phoenix_keypoints_test.pkl','rb')); print('Train:', len(d['train']['keypoints']), 'samples')"
```

## 相关文档

- [PHOENIX数据集关键点提取指南.md](./PHOENIX数据集关键点提取指南.md)
- [数据格式说明](../data/README.md)

---

**文档创建时间**: 2024年
**适用文件**: phoenix_keypoints*.pkl


